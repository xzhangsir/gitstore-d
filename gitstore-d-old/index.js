"use strict";const download=require("download"),gitclone=require("git-clone"),rm=require("rimraf").sync;function gitdownload(e,t,r={}){let o=r.clone||!1,i=(e=normalize(e)).url||getUrl(e,o);return o?(rm(t),new Promise((o,c)=>{gitclone(i,t,{checkout:e.checkout,shallow:"master"===e.checkout,...r},e=>{void 0===e?(rm(t+"/.git*"),o(200)):c(new Error(e))})})):new Promise((e,r)=>{download(i,t,{extract:!0}).then(t=>{e(200)}).catch(e=>{r(new Error(e))})})}function normalize(e){var t=/^(?:(direct):([^#]+)(?:#(.+))?)$/,r=t.exec(e);if(r){var o=r[3]||"master";return{type:"direct",url:r[2],checkout:o}}var i=(r=(t=/^(?:(github|gitee|gitlab|bitbucket):)?(?:(.+):)?([^/]+)\/([^#]+)(?:#(.+))?$/).exec(e))[1]||"github",c=r[2]||null;return null==c&&("github"===i?c="github.com":"gitee"===i?c="gitee.com":"gitlab"===i?c="gitlab.com":"bitbucket"===i&&(c="bitbucket.org")),{type:i,origin:c,owner:r[3],name:r[4],checkout:r[5]||"master"}}function addProtocol({origin:e,type:t},r){return/^(f|ht)tps?:\/\//i.test(e)||(e=r?"gitee"==t?"https://"+e:"git@"+e:"https://"+e),e}function getUrl(e,t){let r,o=addProtocol(e,t);return o+=/^git@/i.test(o)?":":"/",t?r=o+e.owner+"/"+e.name+".git":"github"===e.type?r=o+e.owner+"/"+e.name+"/archive/"+e.checkout+".zip":"gitee"===e.type?r=o+e.owner+"/"+e.name+"/repository/archive/"+e.checkout+".zip":"gitlab"===e.type?r=o+e.owner+"/"+e.name+"/repository/archive.zip?ref="+e.checkout:"bitbucket"===e.type&&(r=o+e.owner+"/"+e.name+"/get/"+e.checkout+".zip"),r}module.exports=gitdownload;